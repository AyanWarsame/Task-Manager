  deploy-to-kubernetes:
    runs-on: ubuntu-latest
    needs: build-and-push
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up kind cluster
      run: |
        curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
        chmod +x ./kind
        sudo mv ./kind /usr/local/bin/kind
        
        # Create kind cluster
        kind create cluster --name task-manager --config kind-config.yaml

    - name: Deploy to Kubernetes
      run: |
        # Wait for cluster to be ready
        kubectl cluster-info
        
        # Deploy database
        kubectl apply -f k8s/database.yaml
        kubectl wait --for=condition=ready pod -l app=postgres --timeout=120s
        
        # Deploy application (replace with your actual image)
        sed -i 's|your-dockerhub-username|${{ secrets.DOCKERHUB_USERNAME }}|g' k8s/app.yaml
        kubectl apply -f k8s/app.yaml
        
        # Wait for app to be ready
        kubectl wait --for=condition=ready pod -l app=taskmanager-app --timeout=120s

    - name: Verify deployment
      run: |
        kubectl get all
        echo "ðŸš€ Application deployed successfully!"
        echo "ðŸ“± Access your app at: http://localhost:5001"